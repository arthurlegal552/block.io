<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snowy Parkour Adventure</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(to bottom, #0c1445, #1a237e);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        #title-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 10, 30, 0.85);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: opacity 1s ease;
        }
        
        #title-screen h1 {
            font-size: 4rem;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(100, 200, 255, 0.8);
            background: linear-gradient(45deg, #4fc3f7, #e1f5fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 3s infinite alternate;
        }
        
        @keyframes glow {
            0% { text-shadow: 0 0 10px rgba(100, 200, 255, 0.8); }
            100% { text-shadow: 0 0 30px rgba(100, 200, 255, 1), 0 0 50px rgba(100, 200, 255, 0.8); }
        }
        
        #title-screen p {
            font-size: 1.2rem;
            max-width: 600px;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        #start-btn {
            padding: 15px 50px;
            font-size: 1.4rem;
            background: linear-gradient(45deg, #0288d1, #4fc3f7);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(0, 150, 255, 0.7);
            margin-top: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(0, 150, 255, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(0, 200, 255, 0.9); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(0, 150, 255, 0.7); }
        }
        
        #start-btn:hover {
            animation: none;
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 200, 255, 0.9);
        }
        
        #ui-overlay {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 50;
            pointer-events: none;
        }
        
        #controls-panel {
            background: rgba(0, 0, 30, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(100, 180, 255, 0.3);
            backdrop-filter: blur(5px);
            max-width: 300px;
        }
        
        #controls-panel h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .key-row {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .key {
            width: 50px;
            height: 50px;
            background: rgba(30, 70, 120, 0.8);
            border: 2px solid rgba(100, 180, 255, 0.5);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .key-label {
            font-size: 1.1rem;
        }
        
        #speed-indicator {
            background: rgba(0, 0, 30, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(100, 180, 255, 0.3);
            backdrop-filter: blur(5px);
            height: fit-content;
            text-align: center;
        }
        
        #speed-indicator h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        
        #speed-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.7);
        }
        
        #instructions {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 1.2rem;
            background: rgba(0, 0, 30, 0.7);
            padding: 15px;
            border-top: 1px solid rgba(100, 180, 255, 0.3);
            backdrop-filter: blur(5px);
        }
        
        canvas {
            display: block;
        }
        
        #particle-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 30, 0.7);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid rgba(100, 180, 255, 0.3);
            cursor: pointer;
            z-index: 50;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }
        
        #particle-toggle:hover {
            background: rgba(30, 70, 120, 0.8);
        }
        
        #sound-toggle {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 30, 0.7);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid rgba(100, 180, 255, 0.3);
            cursor: pointer;
            z-index: 50;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }
        
        #sound-toggle:hover {
            background: rgba(30, 70, 120, 0.8);
        }
        
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.8;
            filter: blur(1px);
        }
        
        #volume-control {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 30, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(100, 180, 255, 0.3);
            z-index: 50;
            backdrop-filter: blur(5px);
        }
        
        #volume-slider {
            width: 150px;
            margin-top: 5px;
            cursor: pointer;
        }
        
        .sound-icon {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="title-screen">
            <h1>‚ùÑÔ∏è Snowy Parkour Adventure ‚ùÑÔ∏è</h1>
            <p>Navigate through a winter wonderland with slow, precise movements. Jump between snow-covered platforms and enjoy the peaceful snowfall.</p>
            <p>Movement speed has been reduced by 60% for a more relaxed experience.</p>
            <button id="start-btn">Start Journey</button>
        </div>
        
        <div id="ui-overlay">
            <div id="controls-panel">
                <h3>Controls</h3>
                <div class="key-row">
                    <div class="key">W</div>
                    <div class="key-label">Move Forward</div>
                </div>
                <div class="key-row">
                    <div class="key">A</div>
                    <div class="key-label">Move Left</div>
                </div>
                <div class="key-row">
                    <div class="key">S</div>
                    <div class="key-label">Move Backward</div>
                </div>
                <div class="key-row">
                    <div class="key">D</div>
                    <div class="key-label">Move Right</div>
                </div>
                <div class="key-row">
                    <div class="key">SPACE</div>
                    <div class="key-label">Jump</div>
                </div>
                <div class="key-row">
                    <div class="key">MOUSE</div>
                    <div class="key-label">Look Around</div>
                </div>
            </div>
            
            <div id="speed-indicator">
                <h3>Movement Speed</h3>
                <div id="speed-value">40%</div>
            </div>
        </div>
        
        <div id="particle-toggle">‚ùÑ Toggle Snow</div>
        <div id="sound-toggle">üîä Toggle Sound</div>
        
        <div id="volume-control">
            <div>Volume: <span id="volume-value">70%</span></div>
            <input type="range" id="volume-slider" min="0" max="100" value="70">
        </div>
        
        <div id="instructions">
            Use WASD to move, SPACE to jump. Navigate through the snowy platforms!
        </div>
    </div>

    <script>
        // Game state
        let gameStarted = false;
        let particlesEnabled = true;
        let soundEnabled = true;
        let snowflakes = [];
        
        // UI Elements
        const titleScreen = document.getElementById('title-screen');
        const startBtn = document.getElementById('start-btn');
        const particleToggle = document.getElementById('particle-toggle');
        const soundToggle = document.getElementById('sound-toggle');
        const instructions = document.getElementById('instructions');
        const speedValue = document.getElementById('speed-value');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeValue = document.getElementById('volume-value');
        
        // Sound elements
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let sounds = {};
        let gainNode = audioContext.createGain();
        gainNode.connect(audioContext.destination);
        
        // Load sounds
        function loadSound(url, name) {
            return fetch(url)
                .then(response => response.arrayBuffer())
                .then(data => audioContext.decodeAudioData(data))
                .then(buffer => {
                    sounds[name] = buffer;
                });
        }
        
        // Play a sound
        function playSound(name, volume = 1) {
            if (!soundEnabled) return;
            
            const source = audioContext.createBufferSource();
            source.buffer = sounds[name];
            
            const soundGain = audioContext.createGain();
            soundGain.gain.value = volume * (gainNode.gain.value);
            
            source.connect(soundGain);
            soundGain.connect(audioContext.destination);
            
            source.start(0);
        }
        
        // Load all sounds
        Promise.all([
            loadSound('https://github.com/arthurlegal552/uncanny-zazu/raw/main/sounds/hotel.mp3', 'ambient'),
            loadSound('https://github.com/arthurlegal552/block.io/raw/main/footsteps.mp3', 'footstep'),
            loadSound('https://github.com/arthurlegal552/block.io/raw/main/roblox-classic-jump.mp3', 'jump'),
            loadSound('https://assets.mixkit.co/sfx/preview/mixkit-ice-crack-1717.mp3', 'land'),
            loadSound('https://assets.mixkit.co/sfx/preview/mixkit-wind-whistling-1249.mp3', 'wind'),
            loadSound('https://assets.mixkit.co/sfx/preview/mixkit-falling-on-snow-387.mp3', 'snowfall')
        ]).then(() => {
            console.log("All sounds loaded");
            // Play ambient sound on loop
            if (soundEnabled) {
                playAmbient();
            }
        }).catch(error => {
            console.error("Error loading sounds:", error);
        });
        
        // Play ambient sound on loop
        function playAmbient() {
            if (!soundEnabled) return;
            
            const source = audioContext.createBufferSource();
            source.buffer = sounds['ambient'];
            source.loop = true;
            
            const ambientGain = audioContext.createGain();
            ambientGain.gain.value = 0.3 * (gainNode.gain.value);
            
            source.connect(ambientGain);
            ambientGain.connect(audioContext.destination);
            
            source.start(0);
        }
        
        // Set volume
        volumeSlider.addEventListener('input', () => {
            const volume = volumeSlider.value / 100;
            gainNode.gain.value = volume;
            volumeValue.textContent = volumeSlider.value + '%';
        });
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 1Ô∏è‚É£ Scene Setup
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0c1445);
        scene.fog = new THREE.Fog(0x1a237e, 10, 150);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);
        
        const renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        document.getElementById('game-container').appendChild(renderer.domElement);
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 2Ô∏è‚É£ Lighting
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // Ambient light
        scene.add(new THREE.AmbientLight(0x404040, 1.5));
        
        // Moonlight
        const moonLight = new THREE.DirectionalLight(0x9db4ff, 0.8);
        moonLight.position.set(-10, 20, 10);
        moonLight.castShadow = true;
        moonLight.shadow.mapSize.width = 1024;
        moonLight.shadow.mapSize.height = 1024;
        scene.add(moonLight);
        
        // Fill light
        const fillLight = new THREE.DirectionalLight(0x4d79ff, 0.3);
        fillLight.position.set(10, 10, -10);
        scene.add(fillLight);
        
        // Ground lights
        const groundLight1 = new THREE.PointLight(0x4db8ff, 1, 30);
        groundLight1.position.set(15, 2, -20);
        scene.add(groundLight1);
        
        const groundLight2 = new THREE.PointLight(0xff4da6, 1, 30);
        groundLight2.position.set(-15, 2, -30);
        scene.add(groundLight2);
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 3Ô∏è‚É£ Snowy Ground
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        const floorGeo = new THREE.PlaneGeometry(200, 200);
        const floorMat = new THREE.MeshStandardMaterial({ 
            color: 0x2c3e50,
            roughness: 0.9,
            metalness: 0.1
        });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);
        
        // Snow cover
        const snowGeo = new THREE.PlaneGeometry(200, 200);
        const snowMat = new THREE.MeshStandardMaterial({ 
            color: 0xe0f7fa,
            roughness: 0.8,
            metalness: 0.05,
            transparent: true,
            opacity: 0.8
        });
        const snow = new THREE.Mesh(snowGeo, snowMat);
        snow.rotation.x = -Math.PI / 2;
        snow.position.y = 0.01;
        snow.receiveShadow = true;
        scene.add(snow);
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 4Ô∏è‚É£ Parkour Blocks with Snow
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        function createBlock(x, y, z, w, h, d, color) {
            const geo = new THREE.BoxGeometry(w, h, d);
            const mat = new THREE.MeshStandardMaterial({ 
                color,
                roughness: 0.7,
                metalness: 0.2
            });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(x, y, z);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            scene.add(mesh);
            
            // Add snow on top
            const snowTopGeo = new THREE.BoxGeometry(w - 0.2, 0.1, d - 0.2);
            const snowTopMat = new THREE.MeshStandardMaterial({ 
                color: 0xffffff,
                roughness: 0.9,
                metalness: 0.05
            });
            const snowTop = new THREE.Mesh(snowTopGeo, snowTopMat);
            snowTop.position.set(x, y + h/2 + 0.05, z);
            snowTop.receiveShadow = true;
            scene.add(snowTop);
            
            return mesh;
        }
        
        // Create parkour course
        createBlock(0, 1, -5, 4, 0.5, 4, 0x3498db);
        createBlock(6, 1.5, -12, 3, 0.5, 3, 0x2ecc71);
        createBlock(-6, 2, -18, 5, 0.5, 2, 0xe74c3c);
        createBlock(0, 3, -25, 3, 0.5, 3, 0xf1c40f);
        createBlock(8, 4, -32, 2, 0.5, 4, 0x9b59b6);
        createBlock(-8, 5, -38, 4, 0.5, 2, 0x1abc9c);
        createBlock(0, 6, -45, 3, 0.5, 10, 0xe67e22);
        
        // Starting platform
        const startPlatform = createBlock(0, 0.5, 0, 6, 0.5, 6, 0x34495e);
        
        // Obstacles
        createBlock(4, 1, -15, 1, 2, 1, 0x95a5a6);
        createBlock(-4, 1, -25, 1, 3, 1, 0x95a5a6);
        createBlock(0, 1, -35, 1, 4, 1, 0x95a5a6);
        
        // Decorative trees
        function createTree(x, z) {
            // Trunk
            const trunkGeo = new THREE.CylinderGeometry(0.3, 0.3, 3, 8);
            const trunkMat = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.set(x, 1.5, z);
            trunk.castShadow = true;
            trunk.receiveShadow = true;
            scene.add(trunk);
            
            // Leaves
            const leavesGeo = new THREE.ConeGeometry(2, 4, 8);
            const leavesMat = new THREE.MeshStandardMaterial({ 
                color: 0x27ae60,
                roughness: 0.9
            });
            const leaves = new THREE.Mesh(leavesGeo, leavesMat);
            leaves.position.set(x, 4, z);
            leaves.castShadow = true;
            leaves.receiveShadow = true;
            scene.add(leaves);
            
            // Snow on leaves
            const snowGeo = new THREE.SphereGeometry(1.5, 8, 8);
            const snowMat = new THREE.MeshStandardMaterial({ 
                color: 0xffffff,
                roughness: 0.9
            });
            const snowCap = new THREE.Mesh(snowGeo, snowMat);
            snowCap.position.set(x, 5.5, z);
            snowCap.castShadow = true;
            scene.add(snowCap);
        }
        
        // Add trees
        createTree(16, -10);
        createTree(-16, -15);
        createTree(12, -30);
        createTree(-12, -25);
        createTree(20, -40);
        createTree(-20, -35);
        createTree(15, -50);
        createTree(-15, -45);
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 5Ô∏è‚É£ Snow Particle System
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        let particleSystem;
        let particleGeometry;
        let particleMaterial;
        const particleCount = 2500;
        
        function createSnowParticles() {
            particleGeometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 200; // x
                positions[i + 1] = Math.random() * 100;     // y
                positions[i + 2] = (Math.random() - 0.5) * 200; // z
            }
            
            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            particleMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.15,
                transparent: true,
                opacity: 0.9,
                blending: THREE.AdditiveBlending
            });
            
            particleSystem = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particleSystem);
        }
        
        function updateSnowParticles(dt) {
            if (!particlesEnabled || !particleSystem) return;
            
            const positions = particleGeometry.attributes.position.array;
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                // Move particles down (snow fall)
                positions[i + 1] -= 1.8 * dt;
                
                // Add slight horizontal movement for wind effect
                positions[i] += (Math.random() - 0.5) * 0.3;
                positions[i + 2] += (Math.random() - 0.5) * 0.3;
                
                // Reset particles that have fallen below ground
                if (positions[i + 1] < 0) {
                    positions[i + 1] = Math.random() * 50 + 50;
                    positions[i] = (Math.random() - 0.5) * 200;
                    positions[i + 2] = (Math.random() - 0.5) * 200;
                }
            }
            
            particleGeometry.attributes.position.needsUpdate = true;
        }
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 6Ô∏è‚É£ Player Controls (SLOW MOVEMENT)
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        const controls = new THREE.PointerLockControls(camera, renderer.domElement);
        scene.add(controls.getObject());
        
        const move = { forward: false, back: false, left: false, right: false };
        const velocity = new THREE.Vector3();
        let canJump = false;
        let lastFootstep = 0;
        let footstepCounter = 0;
        
        const raycaster = new THREE.Raycaster();
        raycaster.ray.direction.set(0, -1, 0);
        raycaster.far = 1.6;
        
        const clock = new THREE.Clock();
        
        // Reduced movement parameters
        const baseSpeed = 1.5; // 60% reduction from original
        let currentSpeed = baseSpeed;
        const jumpForce = 3.5; // Reduced jump height
        
        function getMoveDirection() {
            const dir = new THREE.Vector3();
            const forward = new THREE.Vector3();
            const right = new THREE.Vector3();
            controls.getObject().getWorldDirection(forward);
            forward.y = 0; forward.normalize();
            right.crossVectors(forward, new THREE.Vector3(0,1,0)).normalize();
        
            if (move.forward) dir.add(forward);
            if (move.back) dir.sub(forward);
            if (move.left) dir.sub(right);
            if (move.right) dir.add(right);
            if (dir.length() > 0) dir.normalize();
            return dir;
        }
        
        // Keyboard controls
        document.addEventListener('keydown', e => {
            if (!gameStarted) return;
            
            if (e.code === 'KeyW') move.forward = true;
            if (e.code === 'KeyS') move.back = true;
            if (e.code === 'KeyA') move.left = true;
            if (e.code === 'KeyD') move.right = true;
            if (e.code === 'Space' && canJump) {
                velocity.y = jumpForce;
                canJump = false;
                playSound('jump', 0.7);
            }
        });
        
        document.addEventListener('keyup', e => {
            if (e.code === 'KeyW') move.forward = false;
            if (e.code === 'KeyS') move.back = false;
            if (e.code === 'KeyA') move.left = false;
            if (e.code === 'KeyD') move.right = false;
        });
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 7Ô∏è‚É£ Game Initialization
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        startBtn.addEventListener('click', () => {
            gameStarted = true;
            titleScreen.style.opacity = '0';
            setTimeout(() => {
                titleScreen.style.display = 'none';
            }, 1000);
            instructions.textContent = 'Click to lock controls. Use WASD to move, SPACE to jump!';
            controls.lock();
            
            // Move camera to player position
            camera.position.set(0, 1.6, 0);
            
            // Play wind sound
            if (soundEnabled) {
                const windSource = audioContext.createBufferSource();
                windSource.buffer = sounds['wind'];
                windSource.loop = true;
                
                const windGain = audioContext.createGain();
                windGain.gain.value = 0.2 * (gainNode.gain.value);
                
                windSource.connect(windGain);
                windGain.connect(audioContext.destination);
                
                windSource.start(0);
            }
        });
        
        particleToggle.addEventListener('click', () => {
            particlesEnabled = !particlesEnabled;
            particleToggle.textContent = particlesEnabled ? '‚ùÑ Disable Snow' : '‚ùÑ Enable Snow';
        });
        
        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundToggle.innerHTML = soundEnabled ? 'üîä Disable Sound' : 'üîá Enable Sound';
        });
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 8Ô∏è‚É£ Animation Loop
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        function animate() {
            requestAnimationFrame(animate);
            const dt = clock.getDelta();
            const time = clock.getElapsedTime();
            
            if (gameStarted) {
                // Apply gravity
                velocity.y -= 9.8 * dt;
        
                // Apply damping for smoother movement
                velocity.x *= Math.exp(-12 * dt);
                velocity.z *= Math.exp(-12 * dt);
        
                // Get movement direction
                const dir = getMoveDirection();
                
                // Apply movement with reduced speed
                velocity.x += dir.x * currentSpeed * dt;
                velocity.z += dir.z * currentSpeed * dt;
        
                const pos = controls.getObject().position;
        
                pos.x += velocity.x;
                pos.z += velocity.z;
        
                // Ground and platform collision
                raycaster.ray.origin.copy(pos);
                const hits = raycaster.intersectObjects(scene.children, true);
                if (hits.length > 0) {
                    const dist = hits[0].distance;
                    if (dist < 1.6) {
                        // Play landing sound if we just landed
                        if (velocity.y < -2) {
                            playSound('land', 0.5);
                        }
                        
                        velocity.y = Math.max(0, velocity.y);
                        canJump = true;
                        pos.y = hits[0].point.y + 1.6;
                        
                        // Footstep sounds
                        if ((move.forward || move.back || move.left || move.right) && time - lastFootstep > 0.5) {
                            playSound('footstep', 0.4);
                            lastFootstep = time;
                        }
                    }
                }
        
                pos.y += velocity.y * dt;
                
                // Update snow particles
                updateSnowParticles(dt);
            } else {
                // Intro camera animation
                camera.position.x = Math.sin(time * 0.2) * 10;
                camera.position.z = 10 + Math.cos(time * 0.2) * 10;
                camera.lookAt(0, 0, -20);
            }
        
            renderer.render(scene, camera);
        }
        
        // Initialize snow particles
        createSnowParticles();
        animate();
        
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        // 9Ô∏è‚É£ Window Resizing
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Create some DOM snowflakes for the title screen
        function createTitleSnow() {
            for (let i = 0; i < 100; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.style.width = Math.random() * 5 + 2 + 'px';
                snowflake.style.height = snowflake.style.width;
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.top = Math.random() * 100 + 'vh';
                snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                document.getElementById('title-screen').appendChild(snowflake);
                snowflakes.push({
                    el: snowflake,
                    x: parseFloat(snowflake.style.left),
                    y: parseFloat(snowflake.style.top),
                    speed: Math.random() * 0.5 + 0.3,
                    sway: Math.random() * 0.5 - 0.25
                });
            }
        }
        
        function updateTitleSnow() {
            snowflakes.forEach(snowflake => {
                snowflake.y += snowflake.speed;
                snowflake.x += snowflake.sway;
                
                if (snowflake.y > 100) {
                    snowflake.y = -5;
                    snowflake.x = Math.random() * 100;
                }
                
                snowflake.el.style.top = snowflake.y + 'vh';
                snowflake.el.style.left = snowflake.x + 'vw';
            });
            
            requestAnimationFrame(updateTitleSnow);
        }
        
        createTitleSnow();
        updateTitleSnow();
    </script>
</body>
</html>